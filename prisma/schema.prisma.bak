generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// USER & AUTHENTICATION MODELS
// ========================================

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  role      Role     @default(USER)
  customerId         String?
  subscriptionStatus String? @default("inactive")

  aiTrainingExamples AITrainingExample[] @relation("UserAITrainingExamples")
  subscriptions      Subscription[]
  invoices           Invoice[]
}

enum Role {
  USER
  ADMIN
}

model Audit {
  id        String   @id @default(cuid())
  action    String
  actor     String?
  detail    Json?
  createdAt DateTime @default(now())
}

model AITrainingExample {
  id     String @id @default(uuid())
  userId String
  user   User   @relation("UserAITrainingExamples", fields: [userId], references: [id])
  // add other fields here
}

model Jurisdiction {
  id                 String              @id @default(uuid())
  name               String
  projects           Project[]           @relation("JurisdictionProjects")
  permitTypes        PermitType[]
  permitRequirements PermitRequirement[] @relation("JurisdictionPermitRequirements")
}

model Project {
  id             String       @id @default(uuid())
  jurisdictionId String
  jurisdiction   Jurisdiction @relation("JurisdictionProjects", fields: [jurisdictionId], references: [id])
  // add other fields here
}

model PermitRequirement {
  id             String       @id @default(uuid())
  jurisdictionId String
  jurisdiction   Jurisdiction @relation("JurisdictionPermitRequirements", fields: [jurisdictionId], references: [id])
  // add other fields here
}

model PermitType {
  id             String       @id @default(uuid())
  jurisdictionId String
  jurisdiction   Jurisdiction @relation(fields: [jurisdictionId], references: [id])
}

model AlertRule {
  id          String   @id @default(uuid())
  scope       String   @default("global")
  scopeRef    String?
  kind        String   @default("forecast_spike")
  threshold   Float    @default(0.2)
  windowHours Int      @default(24)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model ForecastLog {
  id          String   @id @default(cuid())
  triggeredAt DateTime @default(now())
  results     Json
}

model SLATask {
  id           String   @id @default(cuid())
  title        String
  description  String
  priority     String
  dueAt        DateTime
  assignedTeam String?
  status       String
  type         String
  createdAt    DateTime @default(now())
}

model SLASettings {
  id        String @id @default(cuid())
  category  String
  threshold Int
  teamId    String?
}

model ProductionModel {
  id           String   @id @default(cuid())
  modelVersion String   @unique
  stage        String
  deployedBy   String?
  deployedAt   DateTime @default(now())
  metadata     Json?
}

model Subscription {
  id                    String   @id @default(cuid())
  userId                String
  user                  User     @relation(fields: [userId], references: [id])
  stripeCustomerId      String
  stripeSubscriptionId  String   @unique
  status                String
  planId                String?
  currentPeriodEnd      DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model Invoice {
  id               String   @id @default(cuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id])
  stripeInvoiceId  String   @unique
  amountTotal      Int?
  currency         String?
  status           String?
  hostedInvoiceUrl String?
  createdAt        DateTime @default(now())
}
